window.zenjs=window.zenjs||{},function(t){t.Event={getTargetByDataKey:function(t,e){for(var i=$(t.target);!i.data(e)&&"BODY"!=(i[0]||{}).nodeName;)i=i.parent();return i},getEventHandler:function(){var e=function(){};return $.extend(!0,e.prototype,t.Event.methods),new e},methods:{events:{},on:function(t,e){return"string"!=typeof t||"[object Function]"!==Object.prototype.toString.call(e)?!1:(this.events[t]||(this.events[t]=[]),this.events[t].push(e))},trigger:function(t){if("string"!=typeof t)return!1;if(!this.events[t])return this.events[t]=[],!1;for(var e=this.events[t],i=Array.prototype.slice.apply(arguments,[1]),n=0,a=e.length;a>n;n++)e[n](i)},off:function(t,e){if(!t&&!e)return void(this.events={});if(!e)return void(this.events[t]=[]);var i=this.events[t],n=i.indexOf(e);i.splice(n,1)}}}}(window.zenjs),define("zenjs/util/event",function(){}),define("zenjs/backbone/tabber",["zenjs/util/event","backbone"],function(t,e){var i=window.zenjs.Event,n=function(){},a=e.View.extend({initialize:function(t){this.activeKey=t.activeKey||"type",this.activeClass=t.activeClass||"active",this.cbOnClicked=t.onClicked||n,this.cbOnDisabledClicked=t.onDisabledClicked||n,this.initDefault(t)},events:{click:"onClicked"},initDefault:function(t){t.defaultData&&t.defaultData.length>0&&this.active(t.defaultData)},onClicked:function(t){if(t.target&&0!==t.target.length){var e=i.getTargetByDataKey(t,this.activeKey),n=""+e.data(this.activeKey);if(e.blur(),n&&"undefined"!==n&&this.activeData!==n&&n&&n.length>0){if(this.disabled===!0)return void(this.activeData!==n&&this.cbOnDisabledClicked());this.$("."+this.activeClass).removeClass(this.activeClass),e.addClass(this.activeClass),this.activeData=n,this.cbOnClicked(_.extend(t||{},{value:n,nTarget:e}))}}},active:function(t,e){this.onClicked(_.extend({target:this.$el.find("[data-"+this.activeKey+'="'+t+'"]:first')},e||{}))},setDisable:function(t){this.disabled=t},setData:function(t){this.activeData=t,this.$("."+this.activeClass).removeClass(this.activeClass),this.$el.find("[data-"+this.activeKey+'="'+this.activeData+'"]:first').addClass(this.activeClass)},getData:function(){return this.activeData}});return a}),define("wap/components/wx_image_preview",[],function(){function t(t){var e=t.attr("data-src")||t.attr("src"),i=e.replace(/!.*?\.jpg/i,"!640x320.jpg");return i}function e(t){var e,i,n=2;for(i=0;n>i;i++)if(t=t.parent(),e=t.attr("href"),e&&/[http|https|tel|mailto]:/i.test(e))return!0;return!1}function i(){var e=t($(this));a(e,[e])}var n=[],a=function(t,e){window.WeixinJSBridge&&window.WeixinJSBridge.invoke("imagePreview",{current:t,urls:e})},s={init:function(){var s=$(".js-view-image"),r=0;s.each(function(){var i=$(this),s=t(i);e(i)||i.width()>=r&&s&&(n.push(s),i.on("click",function(){a(s,n)}))}),$(".js-view-image-list").each(function(i){var n=$(this);n.on("click",".js-view-image-item",function(i){var s=n.find(".js-view-image-item");if(!e($(i.target))){s=s.map(function(){var e=$(this);return t(e)}).toArray();var r=t($(this));a(r,s)}})}),$(document.body).off("click",".js-view-single-image",i).on("click",".js-view-single-image",i)},clear:function(){n=[]}};return window.imagePreview=s,s}),require(["zenjs/backbone/tabber","wap/components/wx_image_preview"],function(t,e){var i=Backbone.View.extend({initialize:function(i){this.tabber=new t({el:$(".js-type-selector"),defaultData:"onepay",onClicked:_(this.onTabberClicked).bind(this)}).render();var n=$(".js-mini-counter");n.MiniCounter({callback:function(t){$(".js-counter-msg").html('<h3>订单状态：您的订单已取消。</h3><hr /><p class="c-orange">您的订单因超时未付款，已经自动取消。</p>')}}),e.init()},events:{"click .js-next":"doSubmitData"},onTabberClicked:function(t){$(".steps").addClass("hide"),$(".js-"+t.value).removeClass("hide")},doSubmitData:function(t){var e=this.$(".js-next").data("url");$.ajax({url:window._global.url.trade+"/pay/peerpay/message.json",type:"POST",dataType:"json",timeout:1e4,data:{order_no:window._global.invite.order_no,kdt_id:window._global.kdt_id,message:$(".invite-message textarea").val(),peerpay_type:this.tabber.getData()},success:function(t){window.location.href=e}})}});new i({el:$("body")})}),define("main",function(){});